<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thoughtcrime Checker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #editor {
      width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 16px;
      outline: none;
      overflow-y: auto;
      white-space: pre-wrap;  /* Fix for Firefox spaces issue */
    }
    .highlight {
      text-decoration: underline;
      text-decoration-color: red;
      text-decoration-style: wavy;
    }
  </style>
</head>
<body>

<h2>Thoughtcrime Checker</h2>
<div id="editor" contenteditable="true" spellcheck="false"></div>


<!-- Description of the project -->
<div id="description">
    <h3>Paste your grant abstract into the text editor above and the Thoughtcrime Checker will underline any words 
        on the <a href="https://bsky.app/profile/jfmclaughlin92.bsky.social/post/3lhd4eswp322v" target="_blank">Banned List!</a></h3>
    <p>
       Edit your grant to remove these words and see if you can avoid the Thought Police!
</p> 
  </div>

  <!-- Add this at the very bottom of your body section -->
<img src="thinkpol_logo.png" alt="Thinkpol logo" style="display: block; margin: 20px auto; max-width: 100%; height: auto;">

<!-- Credits -->
 <div id="credits">
    <p>
        Thoughtcrime Checker was created by <a href="https://bsky.app/profile/bradleyallf.bsky.social" target="_blank">Bradley Allf</a>, 
      and was inspired by the <a href="https://splasho.com/upgoer5/" target="_blank">Up-Goer Five Text Editor</a> by
    <a href="https://bsky.app/profile/theo.io" target="_blank">Theo Sanderson</a>
    (which was itself inspired by <a href="https://bsky.app/profile/xkcd.com" target="_blank">xkcd</a>). 
    More details about the list <a href="https://www.washingtonpost.com/science/2025/02/04/national-science-foundation-trump-executive-orders-words/" target="_blank">here</a>.
    </p>
 </div>

<script>
    const wordsToHighlight = ["activism", "activists", "advocacy", "advocate", "advocates", "barrier", "barriers", "biased", "biased toward", "biases", "biases toward", "bipoc", "black and latinx", "community diversity", "community equity", "cultural differences", "cultural heritage", "culturally responsive", "disabilities", "disability", "discriminated", "discrimination", "diverse backgrounds", "diverse communities", "diverse community", "diverse group", "diverse groups", "diversified", "diversifying", "diversity and inclusion", "diversity equity", "enhance the diversity", "enhancing diversity", "equal opportunity", "equality", "equitable", "equity", "ethnicity", "excluded", "female", "females", "fostering inclusivity", "gender", "gender diversity", "genders", "hate speech", "hispanic minority", "historically", "implicity bias", "implicit biases", "inclusion", "inclusiveness", "inclusivity", "increase diversity", "increase the diversity","indigenous community", "inequalities", "institutional", "lgbt", "marginalize", "marginalized", "minorities", "minority", "multicultural", "polarization", "political", "prejudice", "privileges", "promoting diversity", "race and ethnicity", "racial", "racial diversity", "racial inequality", "racial justice", "racially", "racism", "sense of belonging", "sexual preferences", "social justice", "socio cultural", "socioeconomic", "status", "stereotypes", "systemic", "trauma", "under appreciated", "under represented", "under served", "underrepresentation", "underrepresented", "underserved", "undervalued", "victim", "women", "women and underrepresented"];
  
    function escapeHTML(str) {
      return str.replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
    }
  
    function getCaretCharacterOffsetWithin(element) {
      const selection = window.getSelection();
      let caretOffset = 0;
  
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const preCaretRange = range.cloneRange();
        preCaretRange.selectNodeContents(element);
        preCaretRange.setEnd(range.endContainer, range.endOffset);
        caretOffset = preCaretRange.toString().length;
      }
  
      return caretOffset;
    }
  
    function setCaretPosition(element, offset) {
      const range = document.createRange();
      const selection = window.getSelection();
      let currentNode = null;
      let currentOffset = 0;
  
      function traverseNodes(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          const textLength = node.textContent.length;
          if (currentOffset + textLength >= offset) {
            currentNode = node;
            offset -= currentOffset;
            return true; // Found the position
          }
          currentOffset += textLength;
        } else {
          for (let i = 0; i < node.childNodes.length; i++) {
            if (traverseNodes(node.childNodes[i])) {
              return true;
            }
          }
        }
        return false;
      }
  
      traverseNodes(element);
  
      if (currentNode) {
        range.setStart(currentNode, offset);
        range.collapse(true);
        selection.removeAllRanges();
        selection.addRange(range);
      }
    }
  
    function highlightText() {
      const editor = document.getElementById("editor");
  
      // Save the cursor position relative to text content
      const caretPosition = getCaretCharacterOffsetWithin(editor);
  
      let text = editor.innerText;
      text = escapeHTML(text);
  
      // Highlight words
      wordsToHighlight.forEach(word => {
        const regex = new RegExp(`\\b(${word})\\b`, 'gi');
        text = text.replace(regex, '<span class="highlight">$1</span>');
      });
  
      // Update content
      editor.innerHTML = text;
  
    // If the editor is empty, ensure a zero-width space is there
    if (editor.innerHTML === '') {
      editor.innerHTML = '&#8203;';
    }

      // Restore cursor to original position
      setCaretPosition(editor, caretPosition);
    }
  
    document.getElementById("editor").addEventListener("input", highlightText);
  </script>
  
</body>
</html>